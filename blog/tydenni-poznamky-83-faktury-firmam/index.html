<!DOCTYPE html>
<html lang="cs">
  <head prefix="og: https://ogp.me/ns# profile: https://ogp.me/ns/profile# article: https://ogp.me/ns/article#">
      <meta charset="utf-8">
    <link rel="canonical" href="https://honzajavorek.cz/blog/tydenni-poznamky-83-faktury-firmam/">
    <title>Týdenní poznámky #83: Faktury firmám &mdash; Javorové lístky</title>

    <meta property="og:title" content="Týdenní poznámky #83: Faktury firmám &mdash; Javorové lístky">
    <meta property="og:url" content="https://honzajavorek.cz/blog/tydenni-poznamky-83-faktury-firmam/">

    <link href="https://mastodonczech.cz/@honzajavorek" rel="me">

    <meta property="og:image" content="https://honzajavorek.cz/images/jan-kahanek-g3O5ZtRk2E4-unsplash.jpg">
    <meta property="og:image:width" content="1024">
    <meta property="og:image:height" content="683">
    <meta name="twitter:image" content="https://honzajavorek.cz/images/jan-kahanek-g3O5ZtRk2E4-unsplash.jpg">
    <meta name="twitter:card" content="summary_large_image">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="theme-color" content="#457E31">
    <link rel="icon" href="https://honzajavorek.cz/favicon.ico" sizes="any">
    <link rel="icon" href="https://honzajavorek.cz/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="https://honzajavorek.cz/apple-touch-icon.png">
    <link rel="manifest" href="https://honzajavorek.cz/site.webmanifest">

    <link rel="stylesheet" href="https://honzajavorek.cz/theme/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://honzajavorek.cz/theme/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://honzajavorek.cz/theme/main.css">


  <link rel="stylesheet" href="https://honzajavorek.cz/theme/code.css">

    <link href="https://honzajavorek.cz/feed.xml" type="application/atom+xml" rel="alternate" title="Javorové lístky &mdash; Atom Feed">


  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-02-21T00:00:00+01:00">
  <meta property="article:author" content="https://honzajavorek.cz">
  </head>
  <body>
      <nav class="navigation container">
        <a class="navigation-link btn btn-primary" href="https://honzajavorek.cz/blog/" role="button">
          <i class="bi bi-file-earmark-text"></i> Blog
        </a>
      </nav>
      <div class="content container">
<article class="article">
  <header class="article-author author">
    <a href="https://honzajavorek.cz" class="author-link">
      <img class="author-avatar" alt="Honza Javorek" src="https://honzajavorek.cz/images/theme/honza.jpg" width="50" height="50">
      <span class="author-name">Honza Javorek</span>
    </a>
  </header>
  <h1 class="title display-5">
    Týdenní poznámky #83: Faktury firmám
    <small class="permalink">
      <a href="https://honzajavorek.cz/blog/tydenni-poznamky-83-faktury-firmam/" rel="bookmark" title="Odkaz na tento článek">
        <i class="bi bi-link-45deg"></i>
      </a>
    </small>
  </h1>
  <footer class="article-info info">
    <ul class="info-list">
      <li class="info-published">
        <i class="bi bi-calendar"></i>
        <time datetime="2022-02-21T00:00:00+01:00">
          21. 2. 2022
        </time>
      </li>
      <li class="info-readtime">
        <i class="bi bi-stopwatch"></i>
        14
          min čtení
      </li>
      <li class="info-analytics">
        <i class="bi bi-graph-up"></i>
        <a href="https://simpleanalytics.com/honzajavorek.cz?search=paths%3Ablog/tydenni-poznamky-83-faktury-firmam&interval=week&start=2022-02-21T00:00:00+01:00&end=today">
            Návštěvnost
        </a>
      </li>
    </ul>
  </footer>
  <main class="article-content clearfix">

    <div><div><div><div><p>Utekl zase nějaký ten týden (16.2. — 21.2.) a tak <a href="https://honzajavorek.cz/blog/tydenni-poznamky-82-skalovani/">stejně jako minule</a> sepisuji, co jsem dělal a co zajímavého jsem se naučil. Především se snažím rozvíjet <a href="https://junior.guru/">junior.guru</a>. Nemám šéfa, kterému bych reportoval každý svůj krok, ale mám <a href="https://junior.guru/club/">klub</a>, a členy by mohlo zajímat, jestli se neflákám. Taky je to způsob, jak se sám doma nezbláznit a nepropadat pocitu, že je zase konec týdne a já jsem přitom nestihl nic udělat.</p>
<figure class="figure"><img alt="Poznámky" src="https://honzajavorek.cz/images/jan-kahanek-g3O5ZtRk2E4-unsplash.jpg" class="img-fluid figure-img rounded"><figcaption class="figure-caption">
Fotka od <a href="https://unsplash.com/@honza_kahanek">Honzy Kahánka</a></figcaption></figure>
<p>Tyto poznámky píšu brzo po těch posledních, zas tak moc se toho nestalo, tak to zkusím stihnout napsat do hodiny.</p>
<h2 id="heroine">Heroine<small class="permalink"><a href="#heroine" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Ještě dlužím do Heroine jeden článek, ale nemám teď energii ho psát. Vzhledem k tomu, co všechno jsem pro projekt udělal a taky kvůli různým změnám v tématech, rozhodla se mi šéfredaktorka dát volnou ruku a prostor i pro čistě PR článek upoutávající JG. Já PR článek napsat neumím a asi bych chtěl, aby to bylo nějak užitečné, takže zatím i vymýšlím, jakou formu by to mělo mít.</p>
<p>Se šéfredaktorkou a ještě jednou autorkou jsme se sešli v kavárně v Praze, dávali si nějakou zpětnou vazbu a domlouvali jsme se co bude. Souhlasil jsem, že mi dává smysl pokračovat, ale že teď potřebuji pauzu a i potom bude ode mě třeba jen jeden článek měsíčně. Jednak jsem trochu vyčerpal témata, jednak potřebuji vlastně už řešit zase jiné věci.</p>
<h2 id="marketing">Marketing<small class="permalink"><a href="#marketing" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Rozhodl jsem se, že kromě Heroine už nebudu dělat žádný další marketing nad rámec sociálních sítí, nebo aspoň ne v dohledné době. Heroine chci podpořit jakožto feministický časopis a taky už je to prostě nějak rozjeté, ale další věci bych teď už měl odmítat, protože aktuálně potřebuji škálovat klub a ne do něj přivádět další a další lidi :)</p>
<p>A to jsem si vlastně pořád nevytvořil ani ten marketingový plán, jak jsem o tom psal napodzim :D Změnil jsem od té doby pouze svou strategii ohledně sociálních sítí, které jsem začal dělat víc ručně a víc osobně. A psal jsem články do Heroine.</p>
<p>A začal vycházet podcast, díky kterému JG objevilo hodně lidí. Ale to není jen moje zásluha, to je zásluha především Pavlíny.</p>
<h2 id="sekani-discordu">Sekání Discordu<small class="permalink"><a href="#sekani-discordu" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Zabýval jsem se tím, proč se mi Discord seká na mobilu. Mám iPhone X a mám ho celkem krátce na to, aby se mi na něm jen tak sekaly aplikace. Discord se ale zdá být dost náročná appka. Škoda, že je to teď můj hlavní pracovní nástroj.</p>
<p>Našel jsem nějaké tipy, co mám povypínat. Objevení Ameriky pro mě bylo nastavení <em>background refresh</em>, tedy jestli aplikace mohou na internet i když je zrovna nepoužívám. Zjistil jsem, že to mám skoro u všeho povoleno. Tak jsem to skoro u všeho zakázal.</p>
<p>Trochu to pomohlo. Občas se to pořád sekne, ale není to už tak strašné.</p>
<h2 id="podcast-na-youtube">Podcast na YouTube<small class="permalink"><a href="#podcast-na-youtube" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Z podpory <a href="http://headliner.app/">Headlineru</a> mi odepsali do druhého dne a můj problém vyřešili, takže jsem nemusel nic měnit, na YouTube se mi publikovala všechna podcastová videa. Velké a příjemné překvapení. Poučením budiž, že i příšerný a polofunkční produkt může vytvořit příjemně překvapeného uživatele, když máte kvalitní a rychlý support.</p>
<p>Prozřetelně jsem předtím nastavil, aby se to publikovalo vždy <em>unlisted</em> a že teprve já to dám vždy ručně jako veřejné. Díky tomu jsem mohl přeházet pořadí videí, i když se na YouTube nahrál nejdřív druhý díl s yablkem a až potom první díl s Jirkou Psotkou. Jirku jsem publikoval hned a yablka jsem nastavil ať se publikuje až druhý den. Zafungovalo to a pořadí je pro veřejnost správně.</p>
<h2 id="firmy-a-kupony">Firmy a kupóny<small class="permalink"><a href="#firmy-a-kupony" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Když firma zaplatí za členství v klubu, dostane kupóny, přes které na Discord posílají lidi. Kupóny mi řeší Memberful, stejně jako vše ostatní okolo členství. Není to standardní použití kupónů, je to vlastně spíš zneužití kupónů.</p>
<p>A s tím souvisí zádrhel, na který jsem přišel. Když firma prodlouží po roce členství, začne v tom být trochu nepořádek. Nejlepší, co jsem zatím vymyslel, jsou různé prefixy a doplňky ke kupónům, např. s IDčkem faktury. Udělal jsem podle toho už nové kupóny.</p>
<p>Jenže na kupóny mám navázány i další věci, např. role na Discordu atd., takže bylo potřeba upravit všude kód tak, aby se vypořádal s faktem, že jedna firma může mít kupónů víc. Udělal jsem si parsovací funkci, která vezme řetězec s kupónem a dokáže z jeho formátu vyzobat podstatné informace, kterými se pak může kód dál řídit.</p>
<h2 id="robot-na-stahovani-nabidek-prace">Robot na stahování nabídek práce<small class="permalink"><a href="#robot-na-stahovani-nabidek-prace" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>S robotem na nabídky práce jsem se bohužel moc neposunul. Vyřešil jsem akorát jak se budou řešit nabídky přímo z JG. Dostanou svou vlastní, úplně oddělenou tabulku v databázi. Pak udělám nějakou další, třetí tabulku, kde bude samotný výběr inzerátů, které se mají zobrazit na JG a ten pak bude 1:1 odkazovat na řádky z tabulek pro inzeráty z JG a pro inzeráty stažené odjinud. Nebo se informace při výběru položek překopírují, jako se to dělá v eshopech, když se vytváří objednávka, to už je asi jedno.</p>
<p>Překopal jsem opět skripty na synchronizaci a napsal nový, který se stará o nabídky z JG. Ty tedy vůbec nepůjdou přes scrapery a nebudou se tvářit, že jsou totéž, jako inzerát stažený např. ze StartupJobs.</p>
<p>Nabídky jsou uložené v Google Spreadsheets a občas se mi stalo, že špatně zadané URL probublalo až na web. Např. začínalo www a ne https. Tak jsem na to rovnou udělal kontrolu a když tam taková blbost bude, mělo by to spadnout.</p>
<p>Taky jsem vrátil hromadu testů zpátky do <em>codebase</em>. Ještě jsem nevrátil všechny, ale aspoň ty, které pokrývají samotné scrapery, už jsou zpět.</p>
<p>Teď potřebuji vyřešit, jak stahovat loga firem. Původně se to dělo v rámci Scrapy pipeline, ale tam to už nechci. Z uložených stovek nabídek totiž budu potřebovat stáhnout loga jen pro pár firem, navíc i pro firmy z inzerátů na JG, no prostě je to proces, který by měl být trochu nezávislý na zbytku a souvisí spíše s výběrem vhodných nabídek na web a jejich zobrazením, než s čímkoliv jiným.</p>
<p>Scrapy využiju, protože je tam pěkná <a href="https://docs.scrapy.org/en/latest/topics/media-pipeline.html">media pipeline</a>, ale navržené to ještě nemám. Popravdě mě to trochu zaskočilo, když jsem si uvědomil, že musím rozbombardovat i tohle. Pro většinu věcí jsem měl v hlavě nějaký plán, ale tady si to vezme ještě pár procházek s kočárkem a sprch, než přijdu na dobré řešení.</p>
<h2 id="penize">Peníze!<small class="permalink"><a href="#penize" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<ul>
<li><a href="https://www.fakturoid.cz/">Fakturoid</a> prodloužil svou nehynoucí podporu JG, včetně loga na příručce. Láska!</li>
<li>Zahájili jsme spolupráci s <a href="https://jetveo.io/">Jetveo</a>, low-code platformou se C#. Poslal jsem fakturu (hned proplacená), na úterý chystáme demo platformy v klubu, logo <a href="https://junior.guru/club/">už je na webu</a>, brzo o tom napíšu i na sociální sítě. Na web jsem dal související <a href="https://jetveo.io/blog/articles/jakub-interview">success story juniora Jakuba</a>.</li>
<li>Volali jsme si s <a href="https://www.welcometothejungle.com/en/companies/pure-storage">Pure Storage</a> a brzo taky zahájíme spolupráci. Domluvili jsme se, že přijdou do klubu mentorovat, tak se těším!</li>
<li>Juicymo prodloužilo své nabídky práce na JG: <a href="https://junior.guru/jobs/4187002b6a511f690f8827c3d6811f362fc73c0fa31682f38c67d5ae/">Učenlivý junior Ruby on Rails vývojář</a>, <a href="https://junior.guru/jobs/a48eb9ba324ddbbb1c7fc291128d7727246aef32b13e8808cf0c9f0a/">Učenlivý junior analytik/architekt</a>, <a href="https://junior.guru/jobs/5d41b691a09b074c0324a3fb86031903c2756ca668725ea3e3162187/">Učenlivý Android vývojář</a></li>
<li>V neposlední řadě bych chtěl na tomto místě poděkovat svému nejvěrnějšímu podporovateli, který mi na účet s železnou pravidelností posílá 6 Kč se zprávou „ať se daří“. Miluju tě!</li>
</ul>
<p>Díky tomuto všemu se únorový sloupeček v <a href="https://junior.guru/open/">grafu</a> hezky zvedl a já poprvé přesáhl magickou hranici 30.000 Kč čistého měsíčně!</p>
<h2 id="organizace-prace-a-zivota">Organizace práce a života<small class="permalink"><a href="#organizace-prace-a-zivota" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Rozhodl jsem se, že je aktuálně moje práce příliš chaotická a zkusím tomu dát nějaké mantinely. Prozatím chci využít <em>timeboxingu</em> různých činností na určité dny. Ten daný den prostě stihnu z určitého balíku věcí jen to, co stihnu, a hotovo. Nebudu se tím pak dál trápit. Pokud nepůjde o něco urgentního, nebudu si rozbíjet další dny.</p>
<p>V pondělí chci řešit různou administrativní a komunikační agendu, psaní poznámek, apod. Na středu bych si rád dával cally a pokud by to nešlo, tak aspoň na pondělí. V úterý, čtvrtky a pátky chci mít soustředěnou práci. V pondělky a čtvrtky mám hodinu na sociální sítě, ale to možná rozhodím jinak. A když je večer akce v klubu, nebudu ten den dopoledne pracovat, abych vynahradil večerní ztrátu rodině.</p>
<p>Uvidím, jak se mi to povede dodržovat. Taky stále hledám nějaký nový životní režim s dítětem, takže plánuji i nějaké změny do budoucna a taky se musím naučit nějak aktivně relaxovat. Možná budu zase běhat, možná budu dělat jiné věci, ale tak jak jsem to dělal doteď, to dělat dál prostě nejde.</p>
<h2 id="opravovani-buildu">Opravování buildu<small class="permalink"><a href="#opravovani-buildu" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Moje CircleCI buildy ne a ne procházet. Vždy se najde něco, kvůli čemu to spadne a musím to řešit. Ach jo.</p>
<ul>
<li>Z nějakého důvodu občas failuje skript, který stahuje avatary členů, abych z nich mohl generovat pár náhodných do <a href="https://junior.guru/club/">vrchní části stránky o klubu</a>. Že prý <em>unknown member</em>. Zvýšil jsem logování skriptu, abych tušil, co se tam děje, až se to zase stane.</li>
<li>Skript, kterým generuji XML pro podcast, analyzuje i zvukové stopy a protože to trvá déle, stáhnout velké soubory, dělá to paralelně v procesech. Teď, když už jsou venku 3 díly, začaly GitHub Pages, kde podcast hostuju, timeoutovat :D Tak nevím, jestli je to nejlepší hosting na podcast, možná to budu měnit dřív, než jsem myslel. Počet stahovačů jsem snížil na nanejvýš dva a zatím to funguje.</li>
<li>Ještě mám v kódu stále skript, který z Google Analytics stahuje nějaké metriky o inzerátech na JG, aby je mohl posílat firmám mailem. Už dávno jsem ho chtěl zmigrovat na <a href="simpleanalytics.com/junior.guru">Simple Analytics</a>, žel, nebyl čas a síla. Teď to začalo failovat, GA vrátily pro něco nula dat a moje funkce s tím nepočítala. Zatím jsem to jen narychlo opravil. Přidal jsem test s daty, které vracelo API, a funkci pak upravil tak, aby test prošel.</li>
</ul>
<p>I když jsem všechno tohle vyřešil, spadlo mi to zase třikrát po sobě na nějaké chybě v <em>asyncio</em>, že prý task nemá tu správnou <em>loop</em> nebo co. Já mám totiž hromadu skriptů, které něco dělají. Spustí se, něco dělají a pak skončí. Ty pak mám naházené do jednoho velkého, všechno běží v jednom procesu (pokud se to přes <a href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a> nějak nerozdělí) a všechno shora dolů sekvenčně, jedno po druhém. A tohle se vůbec nedá dělat, když máte něco asynchronní, protože to spustí nějakou tu svou slavnou smyčku a neskončí to, dokud smyčku nezabijete. Ale ta potom už nejde restartovat, prostě šmitec. Takže když máte 10 skriptů imperativního synchronního kódu a pak 5 skriptů, které každý izolovaně něco řeší, ale jsou asynchronní (protože knihovna na práci s Discordem je asynchronní), nemůžete to prostě nasázet za sebe a spustit.</p>
<p>A před časem jsem vymyslel, jak to u té knihovny na Discord udělat a jak si spustit vždy novou smyčku. Pak jsem tam měl scrapery a ty jedou na Scrapy, které jede na Twisted a tam je zase nějaký Twisted reaktor, zase smyčka, ale ta teda spustit ani znova vytvořit nejde, ani za nic. Takže už tam jsem narazil a musel to vytáhnout do procesu vedle přes <a href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a>. Tenhle vedlejší proces si jede se smyčkou asynchronně a hotovo, pak to skončí, původní proces neposkvrněn žádným asynchronním bincem:</p>
<pre class="highlight"><code><span></span><code><span class="n">process</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">_task</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<span class="n">process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">exitcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Process for running async code finished with non-zero exit code: </span><span class="si">{</span><span class="n">process</span><span class="o">.</span><span class="n">exitcode</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_task</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="k">pass</span>  <span class="c1"># tady jsou asynchronní věci</span>
</code></code></pre>

<p>No a delší dobu jsem pozoroval, jak mi asi zlobí i to řešení pro Discord. Že prý task nemá tu správnou <em>loop</em>, i když mít měl. A teď se to nasbíralo a popadalo. Tak jsem to vzdal. Ta <em>loop</em> prostě asi není na tohle dělaná. Tak jsem si řekl ok, vytáhnu to zase do procesu vedle, na hodinu práce.</p>
<p>Houby! Celý den jsem to dělal. Zjistil jsem, že <a href="https://stackoverflow.com/questions/9336646/python-decorator-with-multiprocessing-fails">do procesu nejde poslat nic, co má dekorátor</a>. Jenže já přes dekorátory řeším připojení k databázi a vůbec, chtěl jsem se od té blbosti abstrahovat a ne řešit, jestli někde můžu dát dekorátor nebo nemůžu.</p>
<p>Stále jsem ladil, jak se to bude používat. Nakonec jsem skončil u něčeho jako:</p>
<pre class="highlight"><code><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">run_discord_task</span><span class="p">(</span><span class="s1">'juniorguru.sync.script.do_something'</span><span class="p">)</span>

<span class="nd">@db</span><span class="o">.</span><span class="n">connection_context</span><span class="p">()</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">discord_client</span><span class="p">):</span>
    <span class="k">pass</span>
</code></code></pre>

<p>Funkce <code>run_discord_task()</code> si bere importovací cestu k funkci jako řetězec a ta se vyřeší až v samotném spuštěném vedlejším procesu. Takže <code>do_something()</code> se ani nemusí picklovat a někam posílat, prostě se naimportuje až potom, v procesu, přes <code>importlib</code>.</p>
<p>Když potřebuju databázi, můžu použít dekorátor. Jupí. Až na to, že Peewee nezvládne dekorovat asynchronní funkci, jak jsem zjistil :D A ani se to neplánuje, autor Peewee nemá rád asyncio. Takže jsem si musel přečíst kód Peewee a doprogramovat si to:</p>
<pre class="highlight"><code><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">SqliteDatabase</span> <span class="k">as</span> <span class="n">BaseSqliteDatabase</span><span class="p">,</span> <span class="n">ConnectionContext</span> <span class="k">as</span> <span class="n">BaseConnectionContext</span>

<span class="k">class</span> <span class="nc">ConnectionContext</span><span class="p">(</span><span class="n">BaseConnectionContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Supports async functions when used as decorator"""</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="k">async</span> <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="k">await</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">wrapper</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SqliteDatabase</span><span class="p">(</span><span class="n">BaseSqliteDatabase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">connection_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ConnectionContext</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="n">DB_FILE</span><span class="p">,</span> <span class="n">pragmas</span><span class="o">=</span><span class="p">{</span><span class="s1">'journal_mode'</span><span class="p">:</span> <span class="s1">'wal'</span><span class="p">})</span>
</code></code></pre>

<p>Pak jsem musel upravit všechny skripty, které něco dělají s Discordem, aby fungovaly novým způsobem. No jako hrdý na to nejsem, ale funguje to, třeba to někdy udělám hezčí, ale už tak jsem se s tím patlal moc. Možná existuje nějaké skvělé, elegantní řešení, jak spustit asynchronní kód opakovaně za sebou v rámci synchronního, ale já ho neznám.</p>
<p>Možná existuje nějaký task runner, který by to za mě všechno vyřešil a byl schopen pustit jak synchronní, tak asynchronní kód v pořadí, jaké si určím (a na sobě nezávislé skripty pusit klidně paralelně, to by bylo hezké). Třeba by mi to usnadnilo práci a mohl bych hodně kódu smazat. Já ale nic takového neznám. Možná bych si to měl celé napsat v asyncio.</p>
<p>Nevím, dál. Buildy přestaly failovat, to je teď hlavní :)</p>
<h2 id="dalsi-poznamky">Další poznámky<small class="permalink"><a href="#dalsi-poznamky" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<ul>
<li>Promoval jsem <a href="https://junior.guru/podcast/">nový díl podcastu s yablkem</a>. I yablko <a href="https://twitter.com/yablko/status/1494389432249688067">promoval</a>!</li>
<li>Nakonec jsme se domluvili se Seznamem a jeho podcasty.cz. Vyplnil jsem .docx smlouvy a poslal jim je. Provozuji a svým podnikáním zaštiťuji JG, ale podcast je autorsky v režii Pavlíny, tak jsem se pro tento účel do smluv zapsal jako „sekretář podcastu“. Snad to bude znít lépe než kulisák.</li>
<li>Odpovídal jsem na různé věci v klubu a vítal občánky, kteří přišli. Rozjela se zajímavá diskuze o zakládání startupů nebo o tom, jestli pracovat na IČO nebo ne. Taky bokem trochu řešíme cyklistiku.</li>
<li>Pustil jsem cvičně <code>poetry update</code> a zjistil, že to updatuje víc věcí, než které mi pohlídal dependabot na GitHubu. Tak jsem to commitnul a začalo mi všechno fungovat nějak napůl a padat. Tak jsem to revertnul a udělám to později, jednu knihovnu po druhé :D</li>
<li>Kontaktoval jsem dalšího speakera, který by si měl připravit přednášku do klubu.</li>
<li>Odeslal jsem po poslíčkovi samolepky pro pražské PyLadies.</li>
<li>Zkusil jsem zábavu z klubu <a href="https://twitter.com/honzajavorek/status/1493599032635281410">přenést na Twitter</a>, ale nemělo to žádné reakce ani pokračovatele :D Teda brácha myslím pokračoval, tak pokračovatele to teda jednoho mělo.</li>
<li>Během 6 dní od 16.2. do 21.2. jsem naběhal 9 km, při procházkách nachodil 19 km. Celkem jsem se hýbal 9 hodin a zdolal při tom 28 kilometrů.</li>
<li>Aktuální finanční výsledky, návštěvnost a další čísla k JG <a href="https://junior.guru/open/">mám přímo na webu</a>.</li>
</ul>
<h2 id="co-planuji">Co plánuji<small class="permalink"><a href="#co-planuji" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Tři věci, které bych chtěl zvládnout udělat příště:</p>
<ol>
<li>Pracovat dál na botovi, který stahuje a třídí pracovní nabídky.</li>
<li>Neflákat sociální sítě a propagovat nová partnerství s firmami.</li>
<li>Vyúčtovat studenty jedné vzdělávací agentuře, která mi je posílá do klubu.</li>
</ol>
<h2 id="a-co-vy">A co vy?<small class="permalink"><a href="#a-co-vy" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Pokud byste čistě náhodou měli dojem, že jste oproti mě za uplynulý týden vůbec nic nestihli, tak mám pro vás skvělou zprávu! V klidu se na ten dojem <a href="https://honzajavorek.cz/blog/neni-to-zavod/">můžete vykašlat</a>. Není zač!</p>
<h2 id="co-me-zaujalo">Co mě zaujalo<small class="permalink"><a href="#co-me-zaujalo" title="Odkaz na tento nadpis"><i class="bi bi-link-45deg"></i></a></small></h2>
<p>Když si něco přečtu nebo poslechnu a líbí se mi to, <a href="https://getpocket.com/@honzajavorek">sdílím to na Pocketu</a>. Od posledních poznámek jsem sdílel toto:</p>
<ul>
<li><a href="https://dkb.io/post/google-search-is-dying">Google Search Is Dying</a><br>Dává vám Google vlastně ještě nějaké užitečné výsledky, nebo na vás už sype jen reklamy a přeoptimalizované stránky?</li>
<li><a href="https://nazory.aktualne.cz/komentare/new-york-times/r~30d496ea8fe211eca9b1ac1f6b220ee8/">Pokud Biden neříká o Rusku pravdu, dozvíme se to. Putinovy lži ale nikdo nehlídá</a><br>Komentář o tom, jak i Bílý dům může vypouštět účelové informace, ale na rozdíl od Putina pak dostane přes prsty od svobodných médií.</li>
<li><a href="https://www.mujrozhlas.cz/rapi/view/episode/57920a85-e113-37a4-8191-c118e324e301">Ukrajina mezi „šílenstvím“ Ruska a „hysterií“ Západu. Pohled zpravodaje listu Guardian z Kyjeva</a><br>Pěkný komentář k aktuálnímu dění na Ukrajině.</li>
</ul>
<p><small>Není to vše, co jsem přečetl, slyšel nebo viděl, ale jen zlomek, který mě zaujal. K vygenerování tohoto seznamu jsem použil vlastní knihovnu <a href="https://pypi.org/project/pocket-recommendations/">pocket-recommendations</a>. Věci, které jsem sdílel v den psaní minulých poznámek, se opakují i v těch dalších a je to záměr, ne chyba.</small></p></div></div></div></div>
  </main>

  <footer class="article-footer mb-5">
    <div id="bio" class="article-bio bio">
      <header class="bio-header">
        <img class="bio-avatar" alt="Honza Javorek" src="https://honzajavorek.cz/images/theme/honza.jpg" width="100" height="100" loading="lazy">
        <h3 class="bio-heading">Honza Javorek</h3>
      </header>
      <address class="bio-content">
          Původně programátor, dnes už spíš podnikatel.
          Tvůrce <a href="https://junior.guru/">junior.guru</a>, projektu pro začátečníky v programování.
          Dlouholetý dobrovolník v <a href="https://python.cz">české Python komunitě</a>.
          Podporovatel <a href="https://www.zeleni.cz/">Strany zelených</a>.
          Tohle je můj blog už 16 let.
      </address>
      <ul class="bio-links list-unstyled">
        <li class="bio-links-item">
          <i class="bi bi-person-circle"></i> <a href="https://honzajavorek.cz">Osobní web</a>
        </li>
        <li class="bio-links-item">
          <i class="bi bi-mastodon"></i> <a href="https://mastodonczech.cz/@honzajavorek">Mastodon</a>
        </li>
        <li class="bio-links-item">
          <i class="bi bi-linkedin"></i> <a href="https://linkedin.com/in/honzajavorek">LinkedIn</a>
        </li>
        <li class="bio-links-item">
          <i class="bi bi-github"></i> <a href="https://github.com/honzajavorek/">GitHub</a>
        </li>
      </ul>
    </div>
  </footer>
</article>
      </div>
<aside class="promo seealso">
  <div class="promo-content container">
    <h3 class="promo-heading fs-1">Další Honzovy články</h3>
    <ul class="list-unstyled mb-0">
      <li class="mb-3">
        <i class="bi bi-file-earmark-text"></i>
        2023 —
        <a href="https://honzajavorek.cz/blog/tydenni-poznamky-tipy-pro-novacky-v-klubu-v2/">
          Týdenní poznámky: Tipy pro nováčky v klubu, v2</a>
      </li>
      <li class="mb-3">
        <i class="bi bi-file-earmark-text"></i>
        2021 —
        <a href="https://honzajavorek.cz/blog/volim-marketing/">
          Volím marketing</a>
      </li>
      <li class="mb-3">
        <i class="bi bi-file-earmark-text"></i>
        2021 —
        <a href="https://honzajavorek.cz/blog/bez-auta/">
          Bez auta</a>
      </li>
      <li class="mb-3">
        <i class="bi bi-file-earmark-text"></i>
        2021 —
        <a href="https://honzajavorek.cz/blog/spoustim-klub/">
          Spouštím klub</a>
      </li>
      <li class="mb-3">
        <i class="bi bi-file-earmark-text"></i>
        2016 —
        <a href="https://honzajavorek.cz/blog/kolonizatori-a-spravci-kolonii/">
          Kolonizátoři a správci kolonií</a>
      </li>
      <li>
        <i class="bi bi-search"></i>
        <a href="https://honzajavorek.cz/blog/">Archiv blogu</a>
      </li>
    </ul>
  </div>
</aside>
<aside class="promo jg">
  <div class="promo-content container">
    <img class="promo-logo" alt="junior.guru" src="https://honzajavorek.cz/images/theme/chick.svg" width="100" loading="lazy">
    <h3 class="promo-heading fs-1">I ty můžeš programovat</h3>
    <div class="promo-text">
      <p>
        Programování je <strong>příležitost</strong>. Je to tvá výhoda v kanclu, laborce, redakci.
        Ale taky nová kariéra po rodičovské, pokračování nedokončené školy, nebo prostě náhrada za blbou práci.
      </p>
      <p>
        Chceš to zkusit? Na <strong>junior.guru</strong> najdeš všechno, co potřebuješ!
      </p>
    </div>
    <ul class="promo-nav lead">
      <li class="promo-nav-item">
        <i class="bi bi-book"></i> <a href="https://junior.guru/handbook/">Příručka</a>
      </li>
      <li class="promo-nav-item">
        <i class="bi bi-mic"></i> <a href="https://junior.guru/podcast/">Podcast</a>
      </li>
      <li class="promo-nav-item">
        <i class="bi bi-play-btn"></i> <a href="https://junior.guru/courses/">Kurzy</a>
      </li>
      <li class="promo-nav-item">
        <i class="bi bi-file-earmark-check"></i> <a href="https://junior.guru/jobs/">Práce</a>
      </li>
      <li class="promo-nav-item">
        <i class="bi bi-chat"></i> <a href="https://junior.guru/club/">Klub</a>
      </li>
    </ul>
  </div>
</aside>
      <footer class="footer">
        <address class="footer-content container">
          © Copyright 2007—2023 Honza Javorek
        </address>
      </footer>
    <script defer src="https://honzajavorek.cz/theme/instant.page/instantpage.js"></script>

      <script async defer src="https://scripts.simpleanalyticscdn.com/latest.js"></script>
      <noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif" alt="" referrerpolicy="no-referrer-when-downgrade"></noscript>
  </body>
</html>