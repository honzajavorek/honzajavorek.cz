Title: TÃ½dennÃ­ poznÃ¡mky: Optimalizace obrÃ¡zkÅ¯ a Jamiroquai
Image: images/markus-spiske-RiSAjGsa0vg-unsplash.jpg
Lang: cs
Tags: tÃ½dennÃ­ poznÃ¡mky, junior.guru

Jak se mi daÅ™Ã­ v jednom ÄlovÄ›ku provozovat a rozvÃ­jet [junior.guru](https://junior.guru/)?
Od [poslednÃ­ch poznÃ¡mek]({filename}2023-06-16_tydenni-poznamky-strakovka-podcast-inboxy.md) uÅ¾ utekl nÄ›jakÃ½ ten tÃ½den (16.Â 6. aÅ¾ 23.Â 6.), tak nastal Äas se opÄ›t ohlÃ©dnout a utÅ™Ã­dit si myÅ¡lenky.

![PoznÃ¡mky]({static}/images/markus-spiske-RiSAjGsa0vg-unsplash.jpg)
Fotil [Markus Spiske](https://unsplash.com/@markusspiske)

<div class="alert alert-warning" role="alert" markdown="1">
**ÄŒÃ­sla:**Â FinanÄnÃ­ vÃ½sledky, nÃ¡vÅ¡tÄ›vnost a dalÅ¡Ã­ ÄÃ­sla k junior.guru [mÃ¡m pÅ™Ã­mo na webu](https://junior.guru/open/).
AktuÃ¡lnÃ­ nabÃ­dky prÃ¡ce pro juniory: [Red Hat](https://junior.guru/jobs/aac817ee027512f150caf872e149e12ef9246815b1ecf880501b877d/)

**PlÃ¡ny:** ÄŒetli jste, co [letos plÃ¡nuji]({filename}2022-12-26_strategie-na-2023.md)?
SvÅ¯j postup zaznamenÃ¡vÃ¡m do [tabulky na GitHubu](https://github.com/orgs/juniorguru/projects/1/).
</div>

O vÃ­kendu jsem byl s kamarÃ¡dy na chatÄ› a vÅ¡Ã­m, co jsem tam dÄ›lal, aÅ¥ uÅ¾ to bylo poÅ¾Ã­vÃ¡nÃ­, bÄ›h, Äi tanec, jsem se zniÄil natolik, Å¾e jsem se z toho dostÃ¡val aÅ¾ do ÃºternÃ­ho veÄera.
SeÅ¡lo se to navÃ­c s tÃ­m, Å¾e dceÅ™i rostly zuby, takÅ¾e jsem nemohl nic v noci dospat a byla to ÃºplnÃ¡ krize.

Do toho rÅ¯znÃ­ doktoÅ™i a jinÃ© pochÅ¯zky.
V pondÄ›lÃ­ jsem Å¡el na prvnÃ­ nÃ¡vÅ¡tÄ›vu k psychiatrovi kvÅ¯li diagnostice ADHD.
Byl to fajn pokec, ale jeÅ¡tÄ› budeme mÃ­t nÄ›kolik sezenÃ­, neÅ¾ vydÃ¡ verdikt.

Ve Ätvrtek jsme Å¡li se Å¾enou na Metronome festival.
CÃ­lem bylo sejÃ­t se s kamarÃ¡dy z Brna a vidÄ›t Jamiroquai, ale stihli jsme i Auroru a trochu Aiko.
PSH jsme vzdali, protoÅ¾e budova, kde hrÃ¡li, mÄ›la pÅ™Ã­Å¡ernou akustiku.
Zvuk bolel v uÅ¡Ã­ch a ze slov nebylo rozumÄ›t nic, coÅ¾ zrovna u rapu celkem vadÃ­.

Bylo to poprvÃ© od narozenÃ­ dcery, co jsme se s manÅ¾elkou takhle pozdÄ› veÄer nÄ›kam vypravili.
BabiÄka pÅ™ijela z Moravy a stateÄnÄ› se pokusila o uspÃ¡nÃ­ dÃ­tÄ›te, kterÃ© bez nÃ¡s jeÅ¡tÄ› nikdy neusnulo.
A povedlo se to!
NÃ¡m se zase pro zmÄ›nu povedlo vyhnout se nÄ›jakÃ© tÃ© pÅ™Ã­Å¡ernÃ© bouÅ™ce, kterÃ¡ se Å™Ã­tila na Prahu z NÄ›mecka.

![Jamiroquai]({static}/images/img-4309.jpg)

TÃ­m se uzavÃ­rÃ¡ mÅ¯j divokÃ½ Äerven, do nÄ›hoÅ¾ se mi z dÅ¯vodÅ¯ koordinace vÅ¡elijakÃ½ch termÃ­nÅ¯ vloÅ¾ily prakticky veÅ¡kerÃ© aktivity, kterÃ© jsem chtÄ›l letos v lÃ©tÄ› dÄ›lat.
Jsem z toho pomÄ›rnÄ› vyÄerpanÃ½ a tÄ›Å¡Ã­m se, Å¾e budu mÃ­t koneÄnÄ› nÄ›jakÃ½ tÃ½den, kdy budu jen v prÃ¡ci nebo doma.
MyslÃ­m, Å¾e junior.guru se tÄ›Å¡Ã­ taky, protoÅ¾e teÄ bylo celkem zanedbÃ¡vÃ¡no ğŸ˜

## PÅ™ednÃ¡Å¡ka s Nelou

V ÃºterÃ½ veÄer byla v klubu po dlouhÃ© dobÄ› opÄ›t pÅ™ednÃ¡Å¡ka.
PoprvÃ© jsem si ji chtÄ›l vzÃ­t z novÃ© kancelÃ¡Å™e.

Minuty pÅ™ed zaÄÃ¡tkem jsem vÅ¡ak zjistil, Å¾e byÅ¥ mi jede Discord na chat, nejede mi na zvuk a video.
NepÅ™ipojÃ­ se.
NaÅ¡tÄ›stÃ­ byl v kancelÃ¡Å™i zrovna kamarÃ¡d [MÃ­la](https://milavotradovec.cz/) s neomezenÃ½m internetem v mobilu a pÅ™ipojil mÄ› pÅ™es LTE.
Z toho jsem vzal nakonec celou pÅ™ednÃ¡Å¡ku.
Co bych bez nÄ›j v tu chvÃ­li dÄ›lal, to upÅ™Ã­mnÄ› nevÃ­m.
TakÅ¾e MÃ­lo, jeÅ¡tÄ› jednou fakt dÃ­ky!

DalÅ¡Ã­ den jsme to pak vyÅ™eÅ¡ili.
Discord potÅ™ebuje na volÃ¡nÃ­ nÄ›jakÃ© porty, kterÃ© byly blokovanÃ© na mÃ­stnÃ­m routeru.

Nela mÄ›la pomalejÅ¡Ã­ tempo vyprÃ¡vÄ›nÃ­, ale jinak probÄ›hlo vÅ¡echno v pohodÄ›.
PÅ™ednÃ¡Å¡ka to byla hezkÃ¡, diskuze vÃ½Å¾ivnÃ¡.
ZÃ¡znam bude veÅ™ejnÃ½ a dÃ¡me ho pak zase na strÃ¡nku [Psychika na cestÄ› do IT](https://junior.guru/handbook/mental-health), ale nejdÅ™Ã­v musÃ­ Tinuki dokonÄit jeho stÅ™Ã­hÃ¡nÃ­ âœ‚ï¸

![Nela]({static}/images/20230620-8831c9f9d7408f8d23462a58fa6d6c0278db3046d79cbabb3f069d0cfdadf644-yt.png){: .img-thumbnail }

## Optimalizace obrÃ¡zkÅ¯

BÄ›hem tÃ½dne jsem se nepÅ™Ã­jemnÄ› zamotal do optimalizace obrÃ¡zkÅ¯ na junior.guru.
PÅ™emÃ½Å¡lÃ­m, Å¾e bych generovanÃ© obrÃ¡zky commitoval zpÄ›t do repozitÃ¡Å™e, aby se tÃ­m keÅ¡ovaly a nevytvÃ¡Å™ely pokaÅ¾dÃ© znova.
Jednak se pÅ™Ã­liÅ¡ nemÄ›nÃ­, obÄas akorÃ¡t nÄ›jakÃ½ pÅ™ibude, jednak jejich generovÃ¡nÃ­ trvÃ¡ dost dlouho.

JenÅ¾e aby nezabÃ­raly v Gitu moc mÃ­sta, chtÄ›l jsem je mÃ­t co nejmenÅ¡Ã­.
A to lze docÃ­lit jen optimalizacemi.
Jde o celkem dost obrÃ¡zkÅ¯ a bude jich jen pÅ™ibÃ½vat, takÅ¾e rozdÃ­ly jsou v MB, moÅ¾nÃ¡ desÃ­tkÃ¡ch MB, a to uÅ¾ se po Äase pÅ™i `git pull` poznÃ¡.

Napadlo mÄ›, zda bych se nemohl na vÅ¡echny optimalizace vyprdnout a prostÄ› pouÅ¾Ã­t tÅ™eba WebP, kterÃ½ mÃ¡ urÄitÄ› vÅ¡e uÅ¾ vyÅ™eÅ¡enÃ©.
U screenshotÅ¯ mÄ›l oproti JPEG celkem dobrÃ© vÃ½sledky, tak jsem to pÅ™edÄ›lal.
U generovanÃ½ch PNG to ale nevychÃ¡zelo lÃ­p a hlavnÄ› nejde WebP pÅ™etÃ¡hnout napÅ™. jako obrÃ¡zek ke statusu na LinkedIn, coÅ¾ je pro mÄ› problÃ©m.

[Pillow mÃ¡ option](https://pillow.readthedocs.io/en/stable/handbook/image-file-formats.html#png) `optimize`, coÅ¾ jsem nevÄ›dÄ›l, napovÄ›dÄ›l mi to pÅ™i psanÃ­ GitHub Copilot. Moc velkou parÃ¡du to vÅ¡ak neudÄ›lalo.

HodnÄ› se mi lÃ­bil [pngquant](https://pngquant.org/) v kombinaci s [oxipng](https://github.com/shssoichiro/oxipng).
Prakticky nerozeznatelnÃ© PNG mÄ›lo mÃ­sto 300 kB tÅ™eba jen 70 kB.
JenÅ¾e se mi nÄ›jak nepovedlo to jednoduÅ¡e dostat na CI.
VyÅ¾adovalo to instalaci pÅ™es `apt-get`, coÅ¾ je vÅ¾dy opruz a Äas buildu navÃ­c, a taky se mi nepovedlo najÃ­t adekvÃ¡tnÃ­ balÃ­Äek pro oxipng.
Hledal jsem, zda by to neÅ¡lo udÄ›lat nÄ›jak nativnÄ› v Pythonu a naÅ¡el toto:

- [pyoxipng](https://github.com/nfrasser/pyoxipng)
- [Pillow quantize()](https://github.com/python-pillow/Pillow/pull/1889): `image.quantize(method=Image.Quantize.LIBIMAGEQUANT)`
- OmezenÃ­ palety pomocÃ­ Pillow: `image = image.convert('P', palette=Image.Palette.ADAPTIVE, colors=256)` JenÅ¾e jak je to jen 256 barev, tak to bylo dost hnusnÃ©.

NÄ›kolik dnÃ­ jsem se v tom motal a zkouÅ¡el rÅ¯znÃ¡ Å™eÅ¡nÃ­.
Ten `pyoxipng` mi tÅ™eba fungoval krÃ¡snÄ› lokÃ¡lnÄ›, ale na CI se zÃ¡hadnÄ› zasekÃ¡val.

Nakonec jsem to vzdal a obrÃ¡zky se generujÃ­ neoptimalizovanÃ©.
Budu jejich velikost muset Å™eÅ¡it jinak.
BuÄto je zmenÅ¡Ã­m pÅ™ed commitem lokÃ¡lnÄ›, nebo je nebudu commitovat, ale vyuÅ¾iju tÅ™eba [CircleCI cache](https://circleci.com/docs/caching/), nevÃ­m.
KaÅ¾dopÃ¡dnÄ› mÃ¡m pocit, Å¾e na to, jakÃ¡ je to blbost, jsem v tom utopil straÅ¡nÄ› moc Äasu.

AspoÅˆ se mi povedlo na nÄ›kolika mÃ­stech vÃ½raznÄ› zrychlit generovÃ¡nÃ­ obrÃ¡zkÅ¯ i jinak:

-   MÃ­sto doÄasnÃ©ho adresÃ¡Å™e pro kaÅ¾dÃ½ generovanÃ½ obrÃ¡zek se pouÅ¾Ã­vÃ¡ jeden jako sdÃ­lenÃ¡ keÅ¡.
-   MÃ­sto toho, aby se pokaÅ¾dÃ© kompilovaly SCSS soubory a kopÃ­rovaly se fonty, dÄ›je se to jen jednou.
-   MÃ­sto toho, aby se SCSS kompilovalo ruÄnÄ›, pak se ruÄnÄ› kopÃ­rovaly fonty a pÅ™episovaly jejich cesty, dÄ›lÃ¡ to teÄ speciÃ¡lnÄ› nastavenÃ½ `esbuild`.

Ten poslednÃ­ bod mÄ› potrÃ¡pil, protoÅ¾e `esbuild` se rozbije o relativnÃ­ cesty k fontÅ¯m v balÃ­Äku [@fontsource/inter](https://www.npmjs.com/package/@fontsource/inter).
ProchÃ¡zel jsem nÄ›jakÃ© pluginy, ale nakonec je Å™eÅ¡enÃ­m `precompile` pÅ™Ã­mo v rÃ¡mci [SCSS pluginu](https://github.com/glromeo/esbuild-sass-plugin):

```js
await esbuild.build({
  ...
  plugins: [
    sassPlugin({
      precompile(source, pathname) {
        if (pathname.endsWith('@fontsource/inter/index.css')) {
          return source.replaceAll('./files/', '../../node_modules/@fontsource/inter/files/')
        }
        return source
      },
    }),
  ],
})
```

Taky jsem pÅ™i ladÄ›nÃ­ nejrÅ¯znÄ›jÅ¡Ã­ch problÃ©mÅ¯ dost pÅ™ekopal jak mi funguje logging.
Objevil jsem tÅ™eba [record_factory](https://stackoverflow.com/a/57820456/325365), pomocÃ­ nÃ­Å¾ si loguji z jakÃ©ho procesu je zÃ¡znam, ale pouze pokud nenÃ­ v tom hlavnÃ­m.
ZruÅ¡il jsem logovÃ¡nÃ­ do souboru, protoÅ¾e ho nepouÅ¾Ã­vÃ¡m, a pÅ™idal jsem si `--debug` do CLI, kterÃ© zapne detailnÄ›jÅ¡Ã­ logovÃ¡nÃ­.

## DalÅ¡Ã­

-   PomÃ¡hal jsem [PyCon CZ](https://cz.pycon.org/2023/) tÃ½mu propagovat [moÅ¾nost pÅ™ihlÃ¡sit si na letoÅ¡nÃ­ konferenci pÅ™ednÃ¡Å¡ku nebo workshop](https://cz.pycon.org/2023/cfp/).
    VÃ½zvu jsem dal do asi desÃ­tky FacebookovÃ½ch skupin, ale zdÃ¡ se mi, Å¾e nakonec ze vÅ¡eho nejvÃ­c frÄÃ­ [mÅ¯j status na LinkedIn](https://www.linkedin.com/posts/honzajavorek_python-cfp-pyconcz-activity-7077574515693645824-WkJA).
    Vyhodnocuji si z toho pro osobnÃ­ ÃºÄely, Å¾e Facebook je uÅ¾ asi opravdu mrtvÃ½.
-   SdÃ­lel jsem [status KateÅ™iny Lesch](https://www.linkedin.com/posts/kveselovska_16-kate%C5%99ina-lesch-deloitte-o-um%C4%9Bl%C3%A9-inteligenci-activity-7071741104039047168-IxR-/) o tom, Å¾e byla u nÃ¡s v podcastu.
-   PÅ™ihlÃ¡sil jsem se na podzimnÃ­ pÅ¯lmaraton v Blansku a nejspÃ­Å¡ na jednu letnÃ­ Å¡ifrovaÄku v BrnÄ›.
-   Opravil jsem nÄ›jakÃ© malÃ© chybky na junior.guru.
    RozbitÃ© cesty k souborÅ¯m, Å¡patnÄ› generovanÃ© adresy, atd.
-   E-maily, [klubovÃ½ Discord](https://junior.guru/club/), [Pyvec Slack](https://docs.pyvec.org/operations/support.html#sit-kontaktu).
    Od dovolenÃ© jsem jeÅ¡tÄ› stÃ¡le ve skluzu co se tÃ½Äe ÄtenÃ­ klubu.
-   BÄ›hem 8 dnÃ­ jsem nabÄ›hal 19Â km. Celkem jsem se hÃ½bal 3Â h a zdolal pÅ™i tom 19Â km.
    Detaily na [Strava](https://www.strava.com/athletes/31242569), jedinÃ© sociÃ¡lnÃ­ sÃ­ti, kde si napsÃ¡nÃ­ statusu musÃ­te zaslouÅ¾it.

<div class="alert alert-warning" role="alert" markdown="1">
**OkÃ©nko duÅ¡evnÃ­ho zdravÃ­:**
MÃ¡te dojem, Å¾e na rozdÃ­l ode mnÄ› nic nestÃ­hÃ¡te?
BuÄte v klidu, [nenÃ­ to zÃ¡vod]({filename}2020-06-04_neni-to-zavod.md)!
</div>

## PlÃ¡nuji

1.  VÄ›novat se v klidu rodinÄ› a prÃ¡ci a nic dalÅ¡Ã­ho ğŸ™
2.  Dohnat vÅ¡echny moÅ¾nÃ© resty z poslednÃ­ch tÃ½dnÅ¯.
3.  NÄ›jak uzavÅ™Ã­t pÅ™ekopÃ¡vÃ¡nÃ­ toho, jak se buildÃ­ frontend junior.guru.

## Zaujalo mÄ›

KdyÅ¾ na nÄ›co narazÃ­m a lÃ­bÃ­ se mi to, sdÃ­lÃ­m to [na Telegramu](https://t.me/honzajavorekcz).
Od poslednÃ­ch poznÃ¡mek jsem sdÃ­lel:

- [Call for Proposals: PÅ™ihlaÅ¡ si pÅ™ednÃ¡Å¡ku, workshop nebo sprint na PyCon CZ 23](https://www.youtube.com/watch?v=xNvvK-gPXUo)<br>A uÅ¾ jsem tady psal, Å¾e prÃ¡vÄ› mÅ¯Å¾ete poslat nÃ¡vrh na pÅ™ednÃ¡Å¡ku nebo workshop pro letoÅ¡nÃ­ PyCon CZ, Äeskou Python konferenci? Letos tam bude i celÃ¡ sekce pro zaÄÃ¡teÄnÃ­ky. PusÅ¥te si Dana na videu, vysvÄ›tlÃ­ vÃ¡m, jak to funguje ğŸ™‚ V popisku je pak odkaz pÅ™Ã­mo na formulÃ¡Å™. A nevÃ¡hejte, ten formulÃ¡Å™ nebude uÅ¾ otevÅ™enÃ½ moc dlouho.
- [Gaming On Mac Just Got WAY Better - A Developer's Perspective](https://www.youtube.com/watch?v=Cg1g27MUd_0)<br>ÃÄkovÃ© hry na macOS? Wow.
- [O Pyvci s BÃ¡rou Drbohlavovou (RohlÃ­k.cz) â€” ProgramHRovÃ¡nÃ­ - vÃ¡Å¡ HR prÅ¯vodce svÄ›tem IT](https://overcast.fm/+1O3lj1Evs)<br>KoneÄnÄ› jsem si pustil tohle a super. DÃ­ky BÃ¡ro za super promo pro Pyvec a Python komunitu â¤ï¸ (jsem taky ve vÃ½boru)
- [Digital Culture Is Literally Reshaping Women's Faces](https://www.wired.com/story/flawless-korea-beauty-elise-hu/)<br>â€While fixing individuals reduces prejudice directed toward particular individuals, it increases prejudice in general.â€œ Nebo: â€We assume that desire isÂ objective or subjective, but in reality it rests on a third party who gives value to objects. This third party is usually the one who is closest, the neighbor. When the entire internet population is your neighbor, this is a recipe for conflict.â€
